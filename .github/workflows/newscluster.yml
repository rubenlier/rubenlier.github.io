          # Write newest run to output_latest.json AND append to output.json (history)
          python - << 'PY'
          import json, os
          from datetime import datetime, timezone

          with open("output_new.json","r",encoding="utf-8") as f:
              new_run = json.load(f)

          if not isinstance(new_run, dict):
              raise SystemExit(f"API response is not a dict: {type(new_run)}")

          now = datetime.now(timezone.utc).strftime("%Y-%m-%dT%H:%M:%SZ")
          new_run.setdefault("created_at_utc", now)

          # 1) Latest-only file (overwrite each run)
          with open("output_latest.json","w",encoding="utf-8") as f:
              json.dump([new_run], f, ensure_ascii=False, indent=2)

          # 2) History file (append)
          if os.path.exists("output.json"):
              with open("output.json","r",encoding="utf-8") as f:
                  try:
                      existing = json.load(f)
                  except json.JSONDecodeError:
                      existing = []
          else:
              existing = []

          if isinstance(existing, dict):
              existing = [existing]
          if not isinstance(existing, list):
              raise SystemExit(f"Existing output.json must be list/dict, got {type(existing)}")

          existing.append(new_run)

          with open("output.json","w",encoding="utf-8") as f:
              json.dump(existing, f, ensure_ascii=False, indent=2)

          # Basic validations (same spirit as before)
          clusters = new_run.get("clusters")
          assert isinstance(clusters, list) and len(clusters) > 0, "No clusters in new run"

          ip = new_run.get("input_path")
          assert isinstance(ip, str) and ip.startswith("https://raw.githubusercontent.com/"), f"bad input_path: {ip}"

          print("OK wrote output_latest.json and appended output.json. total runs:", len(existing), "clusters in new run:", len(clusters))
          PY
